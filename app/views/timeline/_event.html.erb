<% @grouped_events.each do |date, events| %>
  
  <div id="date-header"><h2><%= date_header_format(date) %></h2></div>

  <% events.each_with_index do |event, index| %>
      <% if event.classname == "tweet" %>
        <%= content_tag :li, :class => "event item #{event_type(event)} #{spine_position(index)}",  :data => {:date => "#{event.published_at.to_s(:db)}"} do -%>
        <div class="<%= "pointer #{spine_position(index)}" %>"></div>
        <h2>"<%= raw(event.content) %>"</h2>
        <%= image_tag("tweet-icon.png") %>
        <div class="secondary">
          <img class="avatar" src="<%= event.person.avatar_url %>">
          <h3>@<%= event.person.twitter_handle %></h3>
          <p><%= time_ago_in_words(event.published_at) %> ago</p>
          <p><a href="https://twitter.com/<%= event.person.twitter_handle %>" class="twitter-follow-button" data-show-count="false">Follow @<%= event.person.twitter_handle %></a>
              <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
          </p>
        </div>
      <% end -%>
      <div class="clear-<%=spine_position(index)%>"></div>

      <% elsif event.classname == "ghevent" %>
      <%= content_tag :li, :class => "event item #{event_type(event)} #{spine_position(index)}",  :data => {:date => "#{event.published_at.to_s(:db)}"} do -%>
        <div class="<%= "pointer #{spine_position(index)}" %>"></div>
          <h2><%= event.headline %></h2>
          <%= image_tag("ghevent-icon.png") %>
        <div class="secondary">
          <img class="avatar" src="<%= event.person.avatar_url %>">
          <h2>"<%= raw(event.content) %>"</h2>
          <iframe src="http://ghbtns.com/github-btn.html?user=<%= event.username %>&type=follow&count=true"
            allowtransparency="true" frameborder="0" scrolling="0" width="165" height="20"></iframe>
          <p><%= time_ago_in_words(event.published_at) %> ago</p>
        </div>
    <% end -%>
    <div class="clear-<%=spine_position(index)%>"></div>

    <% elsif event.classname == "post" %>
      <%= content_tag :li, :class => "event item #{event_type(event)} #{spine_position(index)}",  :data => {:date => "#{event.published_at.to_s(:db)}"} do -%>
        <div class="<%= "pointer #{spine_position(index)}" %>"></div>
          <h2>"<%= event.title %>"</h2>
          <h3>- by <%= event.person.name %></h3>
          <%= image_tag("post-icon.png") %>
        <div class="secondary">
          <img class="avatar" src="<%= event.person.avatar_url %>">
          <h2><%= truncate((raw(event.content)), :length => 100, :separator => ' ', :omission => '...continued' )%></h2>
          <p><%= time_ago_in_words(event.published_at) %> ago</p>
        </div>
    <% end -%>
    <div class="clear-<%=spine_position(index)%>"></div>

    <% else %>
      <%= content_tag :li, :class => "event item #{event_type(event)} #{spine_position(index)}",  :data => {:date => "#{event.published_at.to_s(:db)}"} do -%>
        <div class="<%= "pointer #{spine_position(index)}" %>"></div>
        <h2><%= raw(event.content) %></h2>
        <div class="secondary"></div>
    <% end -%>
    <div class="clear-<%=spine_position(index)%>"></div>

    <% end %>

  <% end %>

<% end %>
